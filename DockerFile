FROM nextcloud
RUN sed -i "s/ServerAdmin webmaster@localhost/ServerAdmin webmaster@localhost\n      Header always set Strict-Transport-Security \"max-age=15768000; includeSubdomains; preload\"/g" /etc/apache2/sites-available/default-ssl.conf \
    && apt update \
    && apt install -y ffmpeg \
    && apt install -y libbz2-dev \
    && docker-php-ext-install bz2 \
    && cp /usr/src/nextcloud/lib/private/Setup.php /usr/src/nextcloud/lib/private/Setup.php.bak \
    && sed -i "s@newConfigValues = \[@newConfigValues = \[\n                    'filesystem_check_changes' => true,\n                   'localstorage.allowsymlinks' => true,\n                      'default_phone_region' => 'CN',\n                       'enable_previews' => true,\n                    'enabledPreviewProviders' =>\n              array (\n                            0 => 'OC\\\Preview\\\TXT',\n                            1 => 'OC\\\Preview\\\MarkDown',\n                       2 => 'OC\\\Preview\\\OpenDocument',\n                        3 => 'OC\\\Preview\\\PDF',\n                            4 => 'OC\\\Preview\\\MSOffice2003',\n                           5 => 'OC\\\Preview\\\MSOfficeDoc',\n                         6 => 'OC\\\Preview\\\PDF',\n                            7 => 'OC\\\Preview\\\Image',\n                          8 => 'OC\\\Preview\\\Photoshop',\n                           9 => 'OC\\\Preview\\\TIFF',\n                           10 => 'OC\\\Preview\\\SVG',\n                           11 => 'OC\\\Preview\\\Font',\n                       12 => 'OC\\\Preview\\\MP3',\n                           13 => 'OC\\\Preview\\\Movie',\n                         14 => 'OC\\\Preview\\\MKV',\n                        15 => 'OC\\\Preview\\\MP4',\n                           16 => 'OC\\\Preview\\\AVI',\n                       ),@g" /usr/src/nextcloud/lib/private/Setup.php